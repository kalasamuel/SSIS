{% extends 'inventory/base.html' %}
{% block title %}Purchase Orders - Supermarket DBMS{% endblock %}
{% block content %}
<div>
    <div>
        <h2>Purchase Orders</h2>
        <p>Manage and track all purchase orders</p>
    </div>
    <div>
        <a href="{% url 'create_purchase_order' %}">
            New Order
        </a>
        <button type="button">
            Export
        </button>
        <button type="button">
            Analytics
        </button>
    </div>
</div>

<hr>

<div>
    <div>
        <h6>Search & Filters</h6>
    </div>
    <div>
        <div>
            <div>
                <label>Search</label>
                <div>
                    <span>Search:</span>
                    <input type="text" id="searchInput" placeholder="Supplier, invoice, status...">
                </div>
            </div>
            <div>
                <label>Status</label>
                <select id="statusFilter">
                    <option value="">All Status</option>
                    <option value="Pending">Pending</option>
                    <option value="Approved">Approved</option>
                    <option value="Delivered">Delivered</option>
                    <option value="Cancelled">Cancelled</option>
                </select>
            </div>
            <div>
                <label>From Date</label>
                <input type="date" id="fromDateFilter">
            </div>
            <div>
                <label>To Date</label>
                <input type="date" id="toDateFilter">
            </div>
            <div>
                <label>Actions</label>
                <div>
                    <button type="button">
                        Clear Filters
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<hr>

<div id="analyticsPanel" style="display: none;">
    <div>
        <h6>Purchase Order Analytics</h6>
    </div>
    <div>
        <div>
            <div>
                <canvas id="statusChart" width="400" height="200"></canvas>
            </div>
            <div>
                <canvas id="monthlyChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<hr>

<div>
    <div>
        <h6>Purchase Orders</h6>
        <div>
            <span>Total Orders: {{ orders|length }}</span>
            <div>
                <input type="checkbox" id="selectAll">
                <label for="selectAll">Select All</label>
            </div>
        </div>
    </div>
    <div>
        <table id="purchaseOrderTable">
            <thead>
                <tr>
                    <th>
                        <input type="checkbox" id="selectAllCheckbox">
                    </th>
                    <th>Order ID</th>
                    <th>Supplier</th>
                    <th>Order Date</th>
                    <th>Expected Delivery</th>
                    <th>Status</th>
                    <th>Total Cost</th>
                    <th>Invoice No.</th>
                    <th>Staff</th>
                    <th>Actions</th>
                </tr>
            </thead>
        <tbody>
            {% for order in orders %}
            <tr data-order-id="{{ order.id }}">
                <td>
                    <input type="checkbox" class="order-checkbox" value="{{ order.id }}">
                </td>
                <td>
                    <strong>#{{ order.id }}</strong>
                </td>
                <td>
                    <div>
                        <strong>{{ order.supplier.supplier_name }}</strong>
                        {% if order.supplier.contact_number %}
                        <br><small>{{ order.supplier.contact_number }}</small>
                        {% endif %}
                    </div>
                </td>
                <td>{{ order.order_date|date:"M d, Y" }}</td>
                <td>
                    {% if order.expected_delivery_date %}
                        {{ order.expected_delivery_date|date:"M d, Y" }}
                    {% else %}
                        <span>Not set</span>
                    {% endif %}
                </td>
                <td>
                    <span>{{ order.status }}</span>
                </td>
                <td>
                    <strong>${{ order.total_cost|floatformat:0 }}</strong>
                </td>
                <td>
                    {% if order.invoice_no %}
                        <code>{{ order.invoice_no }}</code>
                    {% else %}
                        <span>Not assigned</span>
                    {% endif %}
                </td>
                <td>{{ order.staff.first_name }} {{ order.staff.last_name }}</td>
                <td>
                    <div>
                        <button type="button" 
                                data-bs-toggle="modal" 
                                data-bs-target="#viewOrderModal{{ order.id }}"
                                title="View Details">
                            View
                        </button>
                        <button type="button" 
                                title="Update Status">
                            Edit
                        </button>
                        <div>
                            <button type="button" title="More Actions">
                                More...
                            </button>
                            <ul>
                                <li><a href="#">Print</a></li>
                                <li><a href="#">Duplicate</a></li>
                                <li><hr></li>
                                <li><a href="#">Delete</a></li>
                            </ul>
                        </div>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="10">
                    <div>
                        <div>
                            <h5>No Purchase Orders Found</h5>
                            <p>Get started by creating your first purchase order</p>
                            <a href="{% url 'create_purchase_order' %}">
                                Create First Order
                            </a>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>

<hr>

<div id="bulkActionsBar" style="display: none;">
    <div>
        <div>
            <div>
                <span id="selectedCount">0</span>
                <span>orders selected</span>
            </div>
            <div>
                <button type="button">
                    Update Status
                </button>
                <button type="button">
                    Export Selected
                </button>
                <button type="button">
                    Delete Selected
                </button>
            </div>
        </div>
    </div>
</div>

<hr>

<div>
    <div>
        <div>
            <div>
                <div>
                    <div>
                        <h6>Total Orders</h6>
                        <h3>{{ orders|length }}</h3>
                    </div>
                    <div>
                        (Icon)
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div>
            <div>
                <div>
                    <div>
                        <h6>Pending Orders</h6>
                        <h3>
                            {% for order in orders %}
                                {% if order.status == 'Pending' %}{{ forloop.counter0|add:1 }}{% endif %}
                            {% empty %}0{% endfor %}
                        </h3>
                    </div>
                    <div>
                        (Icon)
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div>
            <div>
                <div>
                    <div>
                        <h6>Delivered Orders</h6>
                        <h3>
                            {% for order in orders %}
                                {% if order.status == 'Delivered' %}{{ forloop.counter0|add:1 }}{% endif %}
                            {% empty %}0{% endfor %}
                        </h3>
                    </div>
                    <div>
                        (Icon)
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div>
            <div>
                <div>
                    <div>
                        <h6>Total Value</h6>
                        <h3>
                            ${% for order in orders %}{{ order.total_cost|add:0 }}{% if not forloop.last %}+{% endif %}{% empty %}0.00{% endfor %}
                        </h3>
                    </div>
                    <div>
                        (Icon)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<hr>

{% for order in orders %}
<div id="viewOrderModal{{ order.id }}">
    <div>
        <div>
            <div>
                <h5>Purchase Order #{{ order.id }}</h5>
                <button type="button" data-bs-dismiss="modal">Close</button>
            </div>
            <div>
                <div>
                    <div>
                        <h6>Order Details</h6>
                        <table>
                            <tr><td><strong>Supplier:</strong></td><td>{{ order.supplier.supplier_name }}</td></tr>
                            <tr><td><strong>Order Date:</strong></td><td>{{ order.order_date|date:"M d, Y" }}</td></tr>
                            <tr><td><strong>Expected Delivery:</strong></td><td>{{ order.expected_delivery_date|date:"M d, Y"|default:"Not set" }}</td></tr>
                            <tr><td><strong>Status:</strong></td><td>{{ order.status }}</td></tr>
                            <tr><td><strong>Total Cost:</strong></td><td>${{ order.total_cost|floatformat:0 }}</td></tr>
                            <tr><td><strong>Invoice No:</strong></td><td>{{ order.invoice_no|default:"Not assigned" }}</td></tr>
                        </table>
                    </div>
                    <div>
                        <h6>Supplier Information</h6>
                        <table>
                            <tr><td><strong>Contact:</strong></td><td>{{ order.supplier.contact_number|default:"N/A" }}</td></tr>
                            <tr><td><strong>Email:</strong></td><td>{{ order.supplier.email|default:"N/A" }}</td></tr>
                            <tr><td><strong>Address:</strong></td><td>{{ order.supplier.address|default:"N/A" }}</td></tr>
                        </table>
                        <h6>Staff Information</h6>
                        <p><strong>Created by:</strong> {{ order.staff.first_name }} {{ order.staff.last_name }}</p>
                    </div>
                </div>
            </div>
            <div>
                <button type="button" data-bs-dismiss="modal">Close</button>
                <a href="#">Edit Order</a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<hr>

<div id="deleteModal">
    <div>
        <div>
            <div>
                <h5>Confirm Delete</h5>
                <button type="button" data-bs-dismiss="modal">Close</button>
            </div>
            <div>
                Are you sure you want to delete this purchase order? This action cannot be undone.
            </div>
            <div>
                <button type="button" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}